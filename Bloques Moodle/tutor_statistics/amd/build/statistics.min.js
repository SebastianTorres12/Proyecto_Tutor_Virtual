define("block_tutor_statistics/statistics",["jquery","core/str"],(function($,str){function waitForChart(callback){"undefined"==typeof Chart?setTimeout((function(){waitForChart(callback)}),100):callback()}return{init:function(){var statisticsDiv=$("#statistics-content");str.get_strings([{key:"no_data",component:"block_tutor_statistics"}]).then((function(translations){var noDataString=translations[0];waitForChart((function(){$.ajax({url:"http://localhost:8080/api/statistics",method:"GET",dataType:"json",success:function(response){console.log("Estadísticas obtenidas:",response);var topUserCtx=$("#top-user-chart")[0].getContext("2d");if(response.top_user&&response.total_messages>0){var topUserMessages=response.top_user.total_messages||0,otherMessages=response.total_messages-topUserMessages;new Chart(topUserCtx,{type:"pie",data:{labels:[response.top_user.userfullname||"Usuario Desconocido","Otros Usuarios"],datasets:[{label:"Número de Mensajes",data:[topUserMessages,otherMessages],backgroundColor:["#007bff","#d3d3d3"],borderColor:["#0056b3","#a9a9a9"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(context){return context.label+": "+context.raw+" mensajes"}}}},animation:{duration:1e3,easing:"easeOutQuart"}}})}else $("#top-user-chart").replaceWith("<p>"+noDataString+" (Usuario Más Activo)</p>");var peakHourCtx=$("#peak-hour-chart")[0].getContext("2d");if(response.peak_hour&&response.total_peak_hour_messages>0){var peakHourMessages=response.peak_hour.message_count||0,otherHourMessages=response.total_peak_hour_messages-peakHourMessages;new Chart(peakHourCtx,{type:"pie",data:{labels:["Hora "+response.peak_hour.hour_of_day,"Otras Horas"],datasets:[{label:"Mensajes en Hora Pico",data:[peakHourMessages,otherHourMessages],backgroundColor:["#28a745","#d3d3d3"],borderColor:["#218838","#a9a9a9"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(context){return context.label+": "+context.raw+" mensajes"}}}},animation:{duration:1e3,easing:"easeOutQuart"}}})}else $("#peak-hour-chart").replaceWith("<p>"+noDataString+" (Hora de Mayor Uso)</p>");var topQuestionCtx=$("#top-question-chart")[0].getContext("2d");if(response.top_question&&response.total_questions>0){var topQuestionFrequency=response.top_question.frequency||0,otherQuestionsFrequency=response.total_questions-topQuestionFrequency;new Chart(topQuestionCtx,{type:"pie",data:{labels:[response.top_question.message_text.length>30?response.top_question.message_text.substring(0,27)+"...":response.top_question.message_text,"Otras Preguntas"],datasets:[{label:"Frecuencia de la Pregunta",data:[topQuestionFrequency,otherQuestionsFrequency],backgroundColor:["#dc3545","#d3d3d3"],borderColor:["#c82333","#a9a9a9"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom",labels:{font:{size:12}}},tooltip:{callbacks:{label:function(context){return context.label+": "+context.raw+" veces"},title:function(context){return"Otras Preguntas"!==context[0].label?response.top_question.message_text:context[0].label}}}},animation:{duration:1e3,easing:"easeOutQuart"}}})}else $("#top-question-chart").replaceWith("<p>"+noDataString+" (Pregunta Más Frecuente)</p>");$.ajax({url:"http://localhost:8000/generar",method:"POST",contentType:"application/json",data:JSON.stringify({instruccion:'\n                                Actúa como un tutor virtual especializado en Análisis y Diseño de Software. Recibirás estadísticas sobre el uso del tutor virtual en un curso, en el siguiente formato JSON:\n                                {\n                                    "top_user": {\n                                        "userfullname": string,\n                                        "total_messages": number\n                                    },\n                                    "total_messages": number,\n                                    "peak_hour": {\n                                        "hour_of_day": number,\n                                        "message_count": number\n                                    },\n                                    "total_peak_hour_messages": number,\n                                    "top_question": {\n                                        "message_text": string,\n                                        "frequency": number\n                                    },\n                                    "total_questions": number\n                                }\n                                Genera una conclusión breve en español (máximo 50 palabras) que recomiende un tema a reforzar para el usuario más activo, basado en la pregunta más frecuente. Usa un tono profesional y no menciones datos específicos como nombres o mensajes exactos para proteger la privacidad.\n                            ',entrada:JSON.stringify(response),max_nuevos_tokens:128}),success:function(apiResponse){if(console.log("Respuesta de la API /generar (conclusión):",apiResponse),apiResponse.respuesta){var conclusionText=apiResponse.respuesta.replace(/\n/g,"<br>");statisticsDiv.append(`\n                                            <div class="conclusion-container">\n                                                <h4>Conclusión del Uso del Tutor Virtual</h4>\n                                                <p>${conclusionText}</p>\n                                            </div>\n                                        `)}else statisticsDiv.append("<p>Error: No se pudo generar la conclusión.</p>")},error:function(xhr,status,error){console.log("Error al generar conclusión:",{xhr:xhr,status:status,error:error}),statisticsDiv.append("<p>Error al generar la conclusión: "+error+"</p>")}})},error:function(xhr,status,error){console.log("Error al obtener estadísticas:",{xhr:xhr,status:status,error:error}),statisticsDiv.html("<p>Error al cargar las estadísticas: "+error+"</p>")}})}))})).fail((function(error){console.log("Error al cargar cadenas de idioma:",error),statisticsDiv.html("<p>Error al cargar las estadísticas: No se pudieron cargar las traducciones.</p>")}))}}}));

//# sourceMappingURL=statistics.min.js.map